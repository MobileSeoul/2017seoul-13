<?php

/*
===========================================================

	프로젝트 이름 : 피리 맵 페이지

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2016년 01월 24일 일요일 오전 05시 21분 - 날씨 추워, 추워!! 너무 추워!!

	저 작 권 : Copyright ⓒ 2014-2015 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 SAM > 피리 맵 페이지 > CONFIG 화일
===========================================================


*/


		#######################################################
		# 시작 => 접근__유효__확인
		#######################################################

		//=====================================================
		// 개별_페이지__접근_불가
		IF ( !defined('_GNUBOARD_') )									EXIT;

		#######################################################
		# 끝 => 접근__유효__확인
		#######################################################



###########################################################
# 시작 => 기본_설정_첨부__하기
###########################################################


		//=====================================================
		// 시작 => 기본_설정_첨부__하기
		IF ($is_get__piree_config == 1)
		{

				//=================================================
				// 설정_정보_파일__첨부
				include_once( get__sam_file(PIREE_PROG_PLUS_MENU_N, 'config', 'path') );

		}
		// 끝 => 기본_설정_첨부__하기
		//=====================================================


###########################################################
# 끝 => 기본_설정_첨부__하기
###########################################################








###########################################################
# 시작 => 상수__변수
###########################################################


		//=====================================================
		// 프로그램_번호
		$map_list_arr['google_map'] = "구글맵";
		$map_list_arr['daum_map']	  = "다음 지도";
		$map_list_arr['naver_map']	= "네이버 지도";


		//=====================================================
		// 지도__지역_국가
		$map_config_region_arr[0]		 = "기본 지도";
		$map_config_region_arr['KR'] = "대한민국";


		//=====================================================
		// 마커_출력수_이상__DATA_있으면
		$marker_limit_exceed_arr[0]			 = "사용하지 않습니다";
		$marker_limit_exceed_arr['page'] = "페이지 분할";
		$marker_limit_exceed_arr['more'] = "더보기 버튼 (추후 제공 예정)";


###########################################################
# 끝 => 상수__변수
###########################################################








###########################################################
# 시작 => 설정
###########################################################


		//=====================================================
		// 프로그램_번호
		$g_program_n = 770033;


		//=====================================================
		// 프로그램_코드
		define('PIREE_PLUS_PIREE_MAP_PAGE_C', 'p'. $g_program_n);


		//=====================================================
		// 프로그램_코드
		$g_program_c = "PIREE MAP Page";


		//=====================================================
		// 프로그램_이름
		$g_program_s = "피리 맵 페이지";


		//=====================================================
		// 버젼
		$g_program_version_s = "0.1.3";


		//=====================================================
		// 테이블__생성_여부
		$g_program_is_create = true;


		//=====================================================
		// 무료_유료__여부
		$is_paid = 1;


		//=====================================================
		// 프로그램_메모
		$prog_memo_s = "게시글을 맵(지도)에 보여주는 기능의 플러그인입니다.";


###########################################################
# 끝 => 설정
###########################################################








###########################################################
# 시작 => 테이블__이름
###########################################################


		//=====================================================
		// 지도_데이터
		$piree_table['map_data']	= G5_TABLE_PREFIX.'_piree_map_data';


		//=====================================================
		// 


###########################################################
# 끝 => 테이블__이름
###########################################################








###########################################################
# 시작 => 기타__설정
###########################################################


		//=====================================================
		// 


###########################################################
# 끝 => 기타__설정
###########################################################








###########################################################
# 시작 => 함수
###########################################################



		#######################################################
		# 시작 => 좌표 등록 - 구글 지도
		#######################################################
		function save__article_coord_google($bo_table, $wr_id, $address, $coord_x = '', $coord_lat = '', $is_ggok = 0)
		{

				//=================================================
				// 시작 => 좌표__없거나____무조건_등록_이면
				IF ( $is_ggok == 1 || !$coord_x || !$coord_lat )
				{

						//=============================================
						// 시작 => 게시판_코드__있으면
						IF ( $bo_table )
						{

								//=========================================
								// 시작 => 게시글_번호__있으면
								IF ( $wr_id > 0 )
								{

										//=====================================
										// 시작 => 주소__있으면
										IF ( $address )
										{

												//=================================
												// 전역변수
												global $g5;


												//=================================
												// 게시판_테이블
												$in_write_table = $g5['write_prefix'] . $bo_table;


												//=================================
												// 구글_지도__키
												$google_map_key = "AIzaSyBBdGENx6e0ZTe0xVnaVzKukOfUImbiT_o";
												$google_map_key = "";


												//=================================
												// 구글_지도_좌표__가져오는__URL
												$get_coord_url  = "https://maps.google.com/maps/api/geocode/xml?";
												$get_coord_url .= "key=". $google_map_key ."&";
												$get_coord_url .= "address=". urlencode($address) ."&";
												$get_coord_url .= "language=ko&";
												$get_coord_url .= "sensor=false";


/*

echo $get_coord_url ." <======== GET_COORD_URL <br>";

*/


												//=================================
												// 구글_지도_좌표__가져오기
												$ch = curl_init();
												curl_setopt($ch, CURLOPT_URL, $get_coord_url);
												curl_setopt($ch, CURLOPT_RETURNTRANSFER , 1);
												curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 3);
												curl_setopt($ch, CURLOPT_TIMEOUT, 3);
												$result = curl_exec ($ch);


/*

echo $result ." <======== RESULT <br>";

*/


												//=================================
												// 좌표__문자열_치환
												$result = str_replace("<lat>", "{EX}", $result);
												$result = str_replace("</lat>", "{EX}", $result);
												$result = str_replace("<lng>", "{EX}", $result);
												$result = str_replace("</lng>", "{EX}", $result);


/*

echo $result ." <======== RESULT >> 2 <br>";

echo "<br>";

echo "<br>";

*/


												//=================================
												// 좌표__뽑아내기
												list($etc1, $return_lat, $etc2, $return_lng, $etc3) = explode("{EX}", $result);


												//=================================
												// 시작 => 좌표__있으면
												IF ( $return_lng || $return_lat)
												{

														//=============================
														// 좌표__저장하기
														$sql  = "UPDATE {$in_write_table} SET ";
														$sql .= "wr_lng='". $return_lng ."', ";
														$sql .= "wr_lat='". $return_lat ."' ";
														$sql .= "WHERE wr_id='". $wr_id ."' OR wr_1='". $address ."'";


/*

echo $sql ." <======== 저장 쿼리 <br>";

*/


														//=============================
														// 시작 => 쿼리_실행__실패시
														IF ( !sql_query($sql) )
														{
																// alert("좌표를 저장하지 못했습니다.");
																echo "좌표를 저장하지 못했습니다. :: ". $sql ." == ";
														}
														// 끝 => 쿼리_실행__실패시
														//=============================


/*

echo $wr_id ." | ". $return_lng ." | ". $return_lat ." <= 저장 <br>";

echo "<br>";

*/


														//=============================
														// 좌표값__넘겨주기
														return array($return_lng, $return_lat);

												}
												// 끝 => 좌표__있으면
												//=================================

										}
										// 끝 => 주소__있으면
										//=====================================

								}
								// 끝 => 게시글_번호__있으면
								//=========================================

						}
						// 끝 => 게시판_코드__있으면
						//=============================================

				}
				// 끝 => 좌표__없거나____무조건_등록_이면
				//=================================================

		}
		#######################################################
		# 끝 => 좌표 등록 - 구글 지도
		#######################################################



		#######################################################
		# 시작 => 지보도기__링크__만들어_반환하기
		#######################################################
		function get_map_article($fnc_bo_table, $fnc_wr_id)
		{

				//=================================================
				// 전역변수
				global $g5, $g_program_n, $p770033__prog_u;


				//=================================================
				// 링크__만들기
				$map_view_link  = $p770033__prog_u .'map_ka.php?';


				//=================================================
				// 시작 => 게시판_코드__있으면
				IF ( $fnc_bo_table )
				{
						// 링크
						$map_view_link .= 'bo_table='. $fnc_bo_table;
				}


				//=================================================
				// 시작 => 게시글__있으면
				IF ( $fnc_wr_id )
				{
						// 링크
						$map_view_link .= '&wr_id='. $fnc_wr_id;
				}


				//=================================================
				// 넘겨주기__링크
				return $map_view_link;

		}
		#######################################################
		# 끝 => 지보도기__링크__만들어_반환하기
		#######################################################


###########################################################
# 끝 => 함수
###########################################################








###########################################################
# 시작 => 피리_맵_페이지____설정_정보__가져오기
###########################################################


		#######################################################
		# 시작 => 피리_프로그램_정보__가져오는__함수
		#######################################################
		function get__prog_info__770033()
		{

				//=================================================
				// 전역_변수
				global $piree, $is_piree_program_config;


				//=================================================
				// 넘겨줄__배열_변수
				$prog_info = array();


				//=================================================
				// 시작 => 피리_프로그램_번호__있으면
				IF ( PIREE_PLUS_PIREE_MAP_PAGE_N > 0 )
				{

						//=============================================
						// 피리_프로그램_정보__가져오기
						$sql = "SELECT * FROM `". $piree['program_sam'] ."` WHERE `pgs_prog_n` = '". PIREE_PLUS_PIREE_MAP_PAGE_N ."'";
						$row = sql_fetch($sql, false);


						//=============================================
						// 시작 => 칼럼__없으면
						IF (!isset($row['pgs_prog_n']))
						{

								//=========================================
								// 전역변수
								global $is_admin;


								//=========================================
								// 시작 => 운영자_일반회원__여부
								IF ($is_admin)
								{

										#######################################
										# 시작 => 운영자__이면

										//=====================================
										// 시작 => 설정_화면__아니면
										IF ($is_piree_program_config != 1)
										{

												// 이동할__페이지
												$move_url = G5_ADMIN_URL.'/p'.PIREE_PROG_PLUS_MENU_N.'/';

												// 에러_알림
												alert ("프로그램이 설치되지 않았거나 DB정보가 없습니다. A - 770033", $move_url);

										}
										// 끝 => 설정_화면__아니면
										//=====================================

								}
								ELSE
								{

										#######################################
										# 시작 => 일반회원__이면

										// 에러_알림
										alert ("프로그램이 설치되지 않았거나 DB정보가 없습니다. B - 770033", G5_URL);

								}
								// 끝 => 운영자_일반회원__여부
								//=========================================

						}
						// 끝 => 칼럼__없으면
						//=============================================


						//=============================================
						// 시작 => 피리_프로그램_번호__맞으면
						IF ( PIREE_PLUS_PIREE_MAP_PAGE_N == $row['pgs_prog_n'] )
						{

								//=========================================
								// 피리_프로그램_정보__배열
								$prog_info = $row;

						}
						// 끝 => 피리_프로그램_번호__맞으면
						//=============================================

				}
				// 끝 => 피리_프로그램_번호__있으면
				//=================================================


				//=================================================
				// 피리_프로그램_정보
				return $prog_info;

		}
		#######################################################
		# 끝 => 피리_프로그램_정보__가져오는__함수
		#######################################################



		#######################################################
		# 시작 => 피리_맵_페이지__설정_정보__가져오는__함수
		#######################################################
		function get_map_page_conf()
		{

				//=================================================
				// 전역_변수
				global $g_program_n, $piree, $is_get__piree_config;


				//=================================================
				// 프로그램_정보
				$prog_conf = array();


				//=================================================
				// 시작 => 피리_프로그램__테이블__유무
				IF (isset($piree['program_sam']) && $is_get__piree_config == 1)
				{

						//=============================================
						// 피리_프로그램_정보__가져오기
						$prog_conf = get__prog_info($g_program_n);

				}
				ELSE
				{

						//=============================================
						// 피리_프로그램_정보__가져오기
						$prog_conf = get__prog_info__770033($g_program_n);

				}
				// 끝 => 피리_프로그램__테이블__유무
				//=================================================


				//=================================================
				// 프로그램_번호
				$prog_conf['g_program_n'] = $g_program_n;


				//=================================================
				// 피리_맵_페이지___설정
				// 넘겨줄_변수
				return $prog_conf;

		}
		#######################################################
		# 끝 => 피리_맵_페이지__설정_정보__가져오는__함수
		#######################################################



		#######################################################
		# 시작 => 피리_맵_페이지____설정_정보__가져오기
		#######################################################

		//=====================================================
		// 피리_맵_페이지__사용여부
		// 0 - 안함
		// 1 - 사용함
		$p770033__use = 0;


		//=====================================================
		// 프로그램__디렉토리
		$p770033__prog_dir = "p". PIREE_PLUS_PIREE_MAP_PAGE_N;


		//=====================================================
		// 프로그램__경로
		$p770033__prog_u = get__sam_file(PIREE_PLUS_PIREE_MAP_PAGE_N, '', 'url');
		$p770033__prog_p = get__sam_file(PIREE_PLUS_PIREE_MAP_PAGE_N, '', 'path');


		//=====================================================
		// 프로그램__이미지__경로
		$p770033__img_u = $p770033__prog_u .'images';
		$p770033__img_p = $p770033__prog_p .'images';


		//=====================================================
		// 시작 => 피리_맵_페이지__설정_정보__가져오기__이면
		IF ( $is_get__p770033 == 1 )
		{

				//=================================================
				// 피리_맵_페이지__정보__가져오기
				$prog_conf = get_map_page_conf();


		    //=================================================
		    // 시작 => 프로그램_번호__맞으면
		    IF ( PIREE_PLUS_PIREE_MAP_PAGE_N == $prog_conf['pgs_prog_n'] )
		    {

						###############################################
						# 시작 => 프로그램__기본_정보
						###############################################

						//=============================================
						// 피리_맵_페이지___사용여부
						// 1 - 사용함
						$p770033__use = 1;


						//=============================================
						// 스킨_PC
						$p770033__skin_pc_c = $prog_conf['pgs_skin_pc_c'];
						$p770033__skin_pc_c = $prog_conf['pgs_skin_pc_c'];
						$p770033__skin_pc_u = $p770033__prog_u . PIREE_SKIN_PC_DIR ."/". $p770033__skin_pc_c;
						$p770033__skin_pc_p = $p770033__prog_p . PIREE_SKIN_PC_DIR ."/". $p770033__skin_pc_c;


						//=============================================
						// 스킨_MOBILE
						$p770033__skin_mo_c = $prog_conf['pgs_skin_mo_c'];
						$p770033__skin_mo_u = $p770033__prog_u . PIREE_SKIN_MO_DIR ."/". $p770033__skin_pc_c;
						$p770033__skin_mo_p = $p770033__prog_p . PIREE_SKIN_MO_DIR ."/". $p770033__skin_pc_c;
						$p770033__skin_mo_p = $p770033__prog_p . PIREE_SKIN_MO_DIR ."/". $p770033__skin_mo_c;


						//=============================================
						// 시작 => DEVIDE__구분
						IF ( G5_IS_MOBILE )
						{

								###########################################
								# 시작 => DEVIDE__모바일__이름

								//=========================================
								// 스킨_정보
								$p770033__skin_c = $p770033__skin_mo_c;
								$p770033__skin_u = $p770033__skin_mo_u;
								$p770033__skin_p = $p770033__skin_mo_p;

						}
						ELSE
						{

								###########################################
								# 시작 => DEVIDE__PC__이면

								//=========================================
								// 스킨_정보
								$p770033__skin_c = $p770033__skin_pc_c;
								$p770033__skin_u = $p770033__skin_pc_u;
								$p770033__skin_p = $p770033__skin_pc_p;

						}
						// 끝 => DEVIDE__구분
						//=============================================

						###############################################
						# 끝 => 프로그램__기본_정보
						###############################################



						###############################################
						# 시작 => 설정_값
						###############################################

						//=============================================
						// 사용할__지도_선택
						$p770033__use_map_c = $prog_conf['pgs_cf_1_s'];


						//=============================================
						// 구글맵__API_KEY
						$p770033__api_key_google_map = $prog_conf['pgs_cf_2_s'];


						//=============================================
						// 다음_지도__API_KEY
						$p770033__api_key_daum_map = $prog_conf['pgs_cf_3_s'];


						//=============================================
						// 네이버_지도__API_KEY
						$p770033__api_key_naver_map = $prog_conf['pgs_cf_4_s'];


						//=============================================
						// 지도_적용_지역
						$p770033__map_view_area = $prog_conf['pgs_cf_5_s'];


						//=============================================
						// 지도_크기__해상도
						$p770033__map_size_h = $prog_conf['pgs_cf_2_n'];


						//=============================================
						// 현재_위치__사용
						$p770033__now_here_point = $prog_conf['pgs_cf_3_n'];


						//=============================================
						// 지도_처음__좌표
						$p770033__map_start_point_lng = $prog_conf['pgs_cf_6_s'];
						$p770033__map_start_point_lat = $prog_conf['pgs_cf_7_s'];


						//=============================================
						// 기본__줌
						$p770033__basic_zoom = $prog_conf['pgs_cf_4_n'];


						//=============================================
						// 보이는__작은_마커_수
						$p770033__view_marker_small_t = $prog_conf['pgs_cf_6_n'];


						//=============================================
						// 사용안함
						### FIELD_NULL
						// $prog_conf['pgs_cf_8_n'];


						//=============================================
						// 사용안함
						### FIELD_NULL
						// $prog_conf['pgs_cf_9_n'];


						//=============================================
						// 마커_출력수__이상_DATA_있으면__보임_방식
						$p770033__marker_count_many_c = $prog_conf['pgs_cf_8_s'];


						//=============================================
						// InfoWindow_크기__해상도
						$p770033__infowin_size_w = $prog_conf['pgs_cf_10_n'];
						$p770033__infowin_size_h = $prog_conf['pgs_cf_11_n'];


						//=============================================
						// 오른쪽_패널_크기__해상도
						$p770033__panel_size_w = $prog_conf['pgs_cf_12_n'];
						$p770033__panel_size_h = $prog_conf['pgs_cf_13_n'];


						//=============================================
						// 패널_게시글_목록_이미지__보여주기_여부
						$p770033__panel_image_view_n = $prog_conf['pgs_cf_14_n'];


						//=============================================
						// 오른쪽_패널_크기__해상도
						$p770033__panel_image_size_w = $prog_conf['pgs_cf_15_n'];
						$p770033__panel_image_size_h = $prog_conf['pgs_cf_16_n'];


						//=============================================
						// 패널에_게시글_수
						$p770033__panel_article_row_n = $prog_conf['pgs_cf_17_n'];


						//=============================================
						// InfoWindow_이미지__보여주기_여부
						$p770033__infowin_image_view_n = $prog_conf['pgs_cf_18_n'];


						//=============================================
						// InfoWindow_이미지_크기_해상도
						$p770033__infowin_image_size_w = $prog_conf['pgs_cf_19_n'];
						$p770033__infowin_image_size_h = $prog_conf['pgs_cf_20_n'];


						//=============================================
						// 지도_로드시_오른쪽_패널__보여주기_여부
						$p770033__panel_load_view_n = $prog_conf['pgs_cf_21_n'];


						//=============================================
						// 클러스터링_기능__사용_여부
						$p770033__clustering_use_n = $prog_conf['pgs_cf_22_n'];


						//=============================================
						// 클러스터링_기능_줌
						$p770033__clustering_zoom = $prog_conf['pgs_cf_23_n'];


						//=============================================
						// 지도_처음__외곽_4지점_좌표

						// 위도_서쪽
						$p770033__map_out_lat_1 = $prog_conf['pgs_cf_10_s'];

						// 위도_동쪽
						$p770033__map_out_lat_2 = $prog_conf['pgs_cf_11_s'];

						// 경도_남쪽
						$p770033__map_out_lng_1 = $prog_conf['pgs_cf_12_s'];

						// 경도_북쪽
						$p770033__map_out_lng_2 = $prog_conf['pgs_cf_13_s'];

						###############################################
						# 끝 => 설정_값
						###############################################

				}
				###################################################
				# 끝 => 프로그램_번호__있으면
				###################################################

		}
		// 끝 => 피리_맵_페이지__설정_정보__가져오기__이면
		//=====================================================

		#######################################################
		# 끝 => 피리_맵_페이지____설정_정보__가져오기
		#######################################################


###########################################################
# 끝 => 피리_맵_페이지____설정_정보__가져오기
###########################################################


?>