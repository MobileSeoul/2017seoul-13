<?php

/*
===========================================================

	프로젝트 이름 : 피리 게시글에 투표, 복수 질문 G5

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2015년 11월 25일 수요일 오후 19시 06분 - 날씨 흐리고 살짝 쌀쌀함

	저 작 권 : Copyright ⓒ 2014-2015 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 > 피리 PWP PLUS G5 > 피리 CONFIG 화일
===========================================================


*/


	#########################################################
	# 시작 => 접근__유효__확인
	#########################################################

	//=======================================================
	// 개별_페이지__접근_불가
	IF ( !defined('_GNUBOARD_') )										EXIT;

	#########################################################
	# 끝 => 접근__유효__확인
	#########################################################



###########################################################
# 시작 => 설정
###########################################################


	//=======================================================
	// 프로그램_이름
	$g_program_s = "피리 테이블 생성";


	//=======================================================
	// 프로그램_번호
	$g_program_n = 770001;


	//=======================================================
	// 피리__기본__프로그램_번호
	$piree_main_program_n = $g_program_n;


	//=======================================================
	// 버젼
	$g_program_version_s = "0.1";


	//=======================================================
	// 테이블__생성_여부
	$g_program_is_create = true;


###########################################################
# 끝 => 설정
###########################################################








###########################################################
# 시작 => 테이블__이름
###########################################################


	//=======================================================
	// 회원_활동_현황__테이블
	$piree_table['member_active_state'] = G5_TABLE_PREFIX.'_member_active_state';


###########################################################
# 끝 => 테이블__이름
###########################################################








###########################################################
# 시작 => 피리_프로그램_정보__테이블_생성
###########################################################


	#########################################################
	# 시작 => 피리_프로그램_정보__가져오는__함수
	#########################################################
	function get__prog_info($prog_n)
	{

			//===================================================
			// 전역_변수
			global $piree, $is_admin, $is_piree_program_config;


			//===================================================
			// 넘겨줄__배열_변수
			$prog_info = array();


			//===================================================
			// 시작 => 피리_프로그램_번호__있으면
			IF ( $prog_n > 0)
			{

					//===============================================
					// 피리_프로그램_정보__가져오기
					$sql = "SELECT * FROM `". $piree['program_sam']."` WHERE `pgs_prog_n` = '". $prog_n ."'";
					$row = sql_fetch($sql, false);


					//===============================================
					// 시작 => 칼럼__없으면
					IF ( !isset($row['pgs_prog_n']) )
					{

							//===========================================
							// 전역변수
							global $is_admin;


							//===========================================
							// 시작 => 운영자_일반회원__여부
							IF ( $is_admin )
							{

									#########################################
									# 시작 => 운영자__이면

									//=======================================
									// 시작 => 설정_화면__아니면
									IF ( $is_piree_program_config != 1)
									{

											// 이동할__페이지
											$move_url = G5_ADMIN_URL.'/p'.PIREE_PROG_PLUS_MENU_N.'/';

											// 에러_알림
											alert ("선택하신 프로그램이 설치되지 않았거나 DB정보가 없습니다. 770001", $move_url);

									}
									// 끝 => 설정_화면__아니면
									//=======================================

							}
							ELSE
							{

									#########################################
									# 시작 => 일반회원__이면

									// 에러_알림
									alert ("선택하신 프로그램이 설치되지 않았거나 DB정보가 없습니다. 770001", G5_URL);

							}
							// 끝 => 운영자_일반회원__여부
							//===========================================

					}
					// 끝 => 칼럼__없으면
					//===============================================


					//===============================================
					// 시작 => 피리_프로그램_번호__맞으면
					IF ( $prog_n == $row['pgs_prog_n'])
					{

							//===========================================
							// 피리_프로그램_정보__배열
							$prog_info = $row;

					}
					// 끝 => 피리_프로그램_번호__맞으면
					//===============================================

			}
			// 끝 => 피리_프로그램_번호__있으면
			//===================================================


			//===================================================
			// 피리_프로그램_정보
			return $prog_info;

	}
	#########################################################
	# 끝 => 피리_프로그램_정보__가져오는__함수
	#########################################################



	#########################################################
	# 시작 => 테이블_생성하기
	#########################################################
	function piree_program_create_table($sql_file_path, $program_n = 0, $replace_ori = null, $replace_tar = null)
	{

			//===================================================
			// 시작 => 화일_경로__있으면
			IF ( file_exists($sql_file_path) )
			{

					//===============================================
					// 테이블_생성
					$file = implode('', file($sql_file_path));
					eval("\$file = \"$file\";");


					//===============================================
					// 문자열_치환
					$file = preg_replace('/^--.*$/m', '', $file);
					$file = preg_replace('/`g5_([^`]+`)/', '`'.G5_TABLE_PREFIX.'$1', $file);


					//===============================================
					// 쿼리문__배열_나누기
					$sql_arr = explode(';', $file);


					//===============================================
					// 시작 => 반복문
					FOR ( $i=0; $i<count($sql_arr); $i++ )
					{

							//===========================================
							// 쿼리문_앞뒤__공백_제거
							$sql_in = trim($sql_arr[$i]);


							//===========================================
							// 프로그램_번호_치환
							$sql_in = str_replace("{PIREE_PROGRAM_N}", $program_n, $sql_in);


							//===========================================
							// 쿼리문_치환
							// $sql_in = preg_replace($replace_ori, $replace_tar, $sql_in);


							//===========================================
							// 시작 => 치환할_배열__있으면
							IF ( $replace_tar && $sql_in )
							{
									//=======================================
									// 쿼리문_치환
									$sql_in = preg_replace($replace_ori, $replace_tar, $sql_in);
							}
							// 끝 => 치환할_배열__있으면
							//===========================================


							//===========================================
							// 시작 => 쿼리문__있으면
							IF ( trim($sql_in) )
							{

									//=======================================
									// 시작 => 테이블_삭제__선택하지_않았으면
									IF ( $is_table_drop != 1 )
									{

											//===================================
											// 시작 => 삭제_쿼리__이면
											IF ( preg_match("^DROP TABLE", $sql_in) )
											{

													// 건너뛰기
													continue;

											}
											// 끝 => 삭제_쿼리__이면
											//===================================

									}
									// 끝 => 테이블_삭제__선택하지_않았으면
									//=======================================


									//=======================================
									// 시작 => 쿼리_실행하기
									IF ( !sql_query($sql_in) )
									{
											alert("[ ". $sql_in ." ] 필요한 테이블을 생성하지 못했습니다.");
											exit;
									}
									// 끝 => 쿼리_실행하기
									//=======================================

							}
							// 끝 => 쿼리문__있으면
							//===========================================

					}
					// 끝 => 반복문
					//===============================================

			}
			// 끝 => 화일_경로__있으면
			//===================================================

	}
	#########################################################
	# 끝 => 테이블_생성하기
	#########################################################


###########################################################
# 끝 => 피리_프로그램_정보__테이블_생성
###########################################################








###########################################################
# 시작 => 함수
###########################################################


	#########################################################
	# 시작 =>
	#########################################################
	function get__770001_func()
	{

			//===================================================
			//


			//===================================================
			//

	}
	#########################################################
	# 끝 =>
	#########################################################


###########################################################
# 끝 => 함수
###########################################################


?>