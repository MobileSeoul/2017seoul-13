<?php

/*
===========================================================

	프로젝트 이름 : 피리 맵 페이지

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2015년 12월 19일 토요일 오후 33시 26분 - 날씨 쌀쌀하지

	저 작 권 : Copyright ⓒ 2014-2015 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 SAM > 관리자 > 피리 맵 페이지 > 설정 정보 저장 처리하기
===========================================================


*/


	#########################################################
	# 시작 => 최_우선__상수__변수
	#########################################################

	//=======================================================
	// 메뉴_번호__지정____피리_맵_페이지
	$sub_menu = 770033;

	#########################################################
	# 끝 => 최_우선__상수__변수
	#########################################################



	#########################################################
	# 시작 => 선_처리__메뉴_지정__관리자_확인
	#########################################################

	//=======================================================
	// 기본처리_파일__첨부
	include_once('./_common.php');


	//=======================================================
	// 시작 => 회원_여부__확인
	IF ($is_guest || !$is_member)
	{
			alert ("회원만 이용하실 수 있습니다", G5_DOMAIN."/");
			EXIT;
	}
	// 끝 => 회원_여부__확인
	//=======================================================


	//=======================================================
	// 시작 => 운영자__아니면
	IF (!$is_admin)
	{
			alert ("권한이 없습니다", G5_DOMAIN."/");
			EXIT;
	}
	// 끝 => 운영자__아니면
	//=======================================================


	//=======================================================
	// 관리자_확인
	auth_check($auth[$sub_menu], "w");

	#########################################################
	# 끝 => 선_처리
	#########################################################



	#########################################################
	# 시작 => 설정__기본값__현재값
	#########################################################

	//=======================================================
	// 설정_정보_화일__첨부
	include_once( get__sam_file($sub_menu, 'config.default.php', 'path') );

	#########################################################
	# 끝 => 설정__기본값__현재값
	#########################################################



	#########################################################
	# 시작 => 피리_맵_페이지__설정_정보_파일__첨부
	#########################################################

	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	// 1 - 하자
	$is_get__piree_config = 0;


	//=======================================================
	// 설정_정보__가져오기
	$is_get__p770033 = 1;


	//=======================================================
	// 설정_화면__여부
	$is_piree_program_config = 1;


	//=======================================================
	// 설정_정보_화일__첨부
	include_once( get__sam_file($sub_menu, 'config', 'path') );

	#########################################################
	# 끝 => 피리_맵_페이지__설정_정보_파일__첨부
	#########################################################



	#########################################################
	# 시작 => 검증하기__기본값
	#########################################################

	//=======================================================
	// 시작 => 사용할__지도_선택_이름__없으면
	IF ( !$map_list_arr[$use_map_c] )
	{
			// 기본값
			$use_map_c = $DEVAR_use_map_c;
	}
	// 끝 => 사용할__지도_선택_이름__없으면
	//=======================================================


	//=======================================================
	// 시작 => 구글맵__사용하고__API_KEY_없으면
	IF ( $use_map_c == 'google_map' && !$api_key_google_map )
	{
			// alert ("[ 구글맵 API KEY ] 를 입력해 주세요'");
	}
	// 끝 => 구글맵__사용하고__API_KEY_없으면
	//=======================================================


	//=======================================================
	// 시작 => 다음_지도__사용하고__API_KEY_없으면
	IF ( $use_map_c == 'daum_map' && !$api_key_daum_map )
	{
			alert ("[ 다음 지도 API KEY ] 를 입력해 주세요'");
	}
	// 끝 => 다음_지도__사용하고__API_KEY_없으면
	//=======================================================


	//=======================================================
	// 시작 => 네이버_지도__사용하고__API_KEY_없으면
	IF ( $use_map_c == 'naver_map' && !$api_key_naver_map )
	{
			alert ("[ 네이버 지도 API KEY ] 를 입력해 주세요'");
	}
	// 끝 => 네이버_지도__사용하고__API_KEY_없으면
	//=======================================================


	//=======================================================
	// 시작 => 지도_크기__해상도__세로
	IF ( !$map_size_h )
	{
			// 기본값
			$map_size_h = $DEVAR_map_size_h;
	}
	// 끝 => 지도_크기__해상도__세로
	//=======================================================


	//=======================================================
	// 시작 => 현재_위치__사용
	IF ( $now_here_point != 1 )
	{
			// 기본값
			$now_here_point = 0;
	}
	// 끝 => 현재_위치__사용
	//=======================================================


	//=======================================================
	// 시작 => 지도_처음__좌표__경도
	IF ( !$map_start_point_lng )
	{
			// 기본값
			$map_start_point_lng = $DEVAR_map_start_point_lng;
	}
	// 끝 => 지도_처음__좌표__경도
	//=======================================================


	//=======================================================
	// 시작 => 지도_처음__좌표__위도
	IF ( !$map_start_point_lat )
	{
			// 기본값
			$map_start_point_lat = $DEVAR_map_start_point_lat;
	}
	// 끝 => 지도_처음__좌표__위도
	//=======================================================


	//=======================================================
	// 시작 => 기본__줌
	IF ( !$basic_zoom )
	{
			// 기본값
			$basic_zoom = $DEVAR_basic_zoom;
	}
	// 끝 => 기본__줌
	//=======================================================


	//=======================================================
	// 시작 => 보이는__작은_마커_수
	IF ( !$view_marker_small_t )
	{
			// 기본값
			$view_marker_small_t = $DEVAR_view_marker_small_t;
	}
	// 끝 => 보이는__작은_마커_수
	//=======================================================


	//=======================================================
	// 시작 => 마커_출력수__이상_DATA_있으면__보임_방식
	IF ( !$marker_limit_exceed_arr[$marker_count_many_c] )
	{
			// 기본값
			$marker_count_many_c = 0;
	}
	// 끝 => 마커_출력수__이상_DATA_있으면__보임_방식
	//=======================================================


	//=======================================================
	// 시작 => INFOWINDOW_크기_X__해상도
	IF ( !$infowin_size_w )
	{
			// 기본값
			$infowin_size_w = $DEVAR_infowin_size_w;
	}
	// 끝 => INFOWINDOW_크기_X__해상도
	//=======================================================


	//=======================================================
	// 시작 => INFOWINDOW_크기_Y__해상도
	IF ( !$infowin_size_h )
	{
			// 기본값
			$infowin_size_h = $DEVAR_infowin_size_h;
	}
	// 끝 => INFOWINDOW_크기_Y__해상도
	//=======================================================


	//=======================================================
	// 시작 => 오른쪽_패널_크기_X__해상도
	IF ( !$panel_size_w )
	{
			// 기본값
			$panel_size_w = $DEVAR_panel_size_w;
	}
	// 끝 => 오른쪽_패널_크기_X__해상도
	//=======================================================


	//=======================================================
	// 시작 => 오른쪽_패널_크기_Y__해상도
	IF ( !$panel_size_h )
	{
			// 기본값
			$panel_size_h = $DEVAR_panel_size_h;
	}
	// 끝 => 오른쪽_패널_크기_Y__해상도
	//=======================================================


	//=======================================================
	// 시작 => 패널_게시글_목록_이미지__보여주기_여부
	IF ( $panel_image_view_n != 1 )
	{
			// 기본값
			$panel_image_view_n = 0;
	}
	// 끝 => 패널_게시글_목록_이미지__보여주기_여부
	//=======================================================


	//=======================================================
	// 시작 => 오른쪽_패널_크기_X__해상도
	IF ( !$panel_image_size_w )
	{
			// 기본값
			$panel_image_size_w = $DEVAR_panel_image_size_w;
	}
	// 끝 => 오른쪽_패널_크기_X__해상도
	//=======================================================


	//=======================================================
	// 시작 => 오른쪽_패널_크기_Y__해상도
	IF ( !$panel_image_size_h )
	{
			// 기본값
			$panel_image_size_h = $DEVAR_panel_image_size_h;
	}
	// 끝 => 오른쪽_패널_크기_Y__해상도
	//=======================================================


	//=======================================================
	// 시작 => 패널에_게시글_수
	IF ( !$panel_article_row_n )
	{
			// 기본값
			$panel_article_row_n = $DEVAR_panel_article_row_n;
	}
	// 끝 => 패널에_게시글_수
	//=======================================================


	//=======================================================
	// 시작 => InfoWindow_이미지__보여주기_여부
	IF ( $infowin_image_view_n != 1 )
	{
			// 기본값
			$infowin_image_view_n = 0;
	}
	// 끝 => InfoWindow_이미지__보여주기_여부
	//=======================================================


	//=======================================================
	// 시작 => INFOWINDOW_이미지_크기_X__해상도
	IF ( !$infowin_image_size_w )
	{
			// 기본값
			$infowin_image_size_w = $DEVAR_infowin_image_size_w;
	}
	// 끝 => INFOWINDOW_이미지_크기_X__해상도
	//=======================================================


	//=======================================================
	// 시작 => INFOWINDOW_이미지_크기_Y__해상도
	IF ( !$infowin_image_size_h )
	{
			// 기본값
			$infowin_image_size_h = $DEVAR_infowin_image_size_h;
	}
	// 끝 => INFOWINDOW_이미지_크기_Y__해상도
	//=======================================================


	//=======================================================
	// 시작 => 지도_로드시_오른쪽_패널__보여주기_여부
	IF ( $panel_load_view_n != 1 )
	{
			// 기본값
			$panel_load_view_n = 0;
	}
	// 끝 => 지도_로드시_오른쪽_패널__보여주기_여부
	//=======================================================


	//=======================================================
	// 시작 => 클러스터링_기능__사용_여부
	IF ( $clustering_use_n != 1 )
	{
			// 기본값
			$clustering_use_n = 0;
	}
	// 끝 => 클러스터링_기능__사용_여부
	//=======================================================


	//=======================================================
	// 시작 => 클러스터링_기능_줌
	IF ( $clustering_zoom < 1 && $clustering_zoom > 20 )
	{
			// 기본값
			$clustering_zoom = $DEVAR_clustering_zoom;
	}
	// 끝 => 클러스터링_기능_줌
	//=======================================================

	#########################################################
	# 끝 => 검증하기__기본값
	#########################################################



	#########################################################
	# 시작 => 상수__변수__배열
	#########################################################

	//=======================================================
	// 정보_저장__여부
	// 0 - 실패
	// 1 - 성공
	$is_save = 0;


	//=======================================================
	// 이동할__페이지
	$go_url_s = "./__field_add.php";

	#########################################################
	# 끝 => 상수__변수__배열
	#########################################################



	#########################################################
	# 시작 => 피리__기본_정보_파일__첨부
	#########################################################

	//=======================================================
	// 피리__기본_정보_화일__경로
	$piree_admin_lib_path = G5_ADMIN_PATH ."/_piree/pi__lib_new.php";


	//=======================================================
	// 피리__기본_정보_파일__첨부
	include_once($piree_admin_lib_path);


	//=======================================================
	// 프로그램_정보__저장하기
	save_piree__program_info($sub_menu);

	#########################################################
	# 끝 => 피리__기본_정보_파일__첨부
	#########################################################



	#########################################################
	# 시작 => 설정__저장하기
	#########################################################

			#####################################################
			# 시작 => 스킨__저장하기
			#####################################################

			//===================================================
			// 공통_쿼리__조합
			$sql_common  = "`pgs_prog_s`    = '". $g_program_s ."', ";
			$sql_common .= "`pgs_skin_pc_c` = '". $skin_pc_c ."', ";
			$sql_common .= "`pgs_skin_mo_c` = '". $skin_mo_c ."', ";

			#####################################################
			# 끝 => 스킨__저장하기
			#####################################################



			#####################################################
			# 시작 => 항목별__저장하기
			#####################################################

			//===================================================
			// 사용할__지도_선택
			$sql_common .= "`pgs_cf_1_s` = '". $use_map_c ."', ";


			//===================================================
			// 구글맵__API_KEY
			$sql_common .= "`pgs_cf_2_s` = '". $api_key_google_map ."', ";


			//===================================================
			// 다음_지도__API_KEY
			$sql_common .= "`pgs_cf_3_s` = '". $api_key_daum_map ."', ";


			//===================================================
			// 네이버_지도__API_KEY
			$sql_common .= "`pgs_cf_4_s` = '". $api_key_naver_map ."', ";


			//===================================================
			// 지도_적용_지역
			$sql_common .= "`pgs_cf_5_s` = '". $map_view_area ."', ";


			//===================================================
			// 지도_크기__해상도
			$sql_common .= "`pgs_cf_2_n` = '". $map_size_h ."', ";


			//===================================================
			// 현재_위치__사용
			$sql_common .= "`pgs_cf_3_n` = '". $now_here_point ."', ";


			//===================================================
			// 지도_처음__좌표
			$sql_common .= "`pgs_cf_6_s` = '". $map_start_point_lng ."', ";
			$sql_common .= "`pgs_cf_7_s` = '". $map_start_point_lat ."', ";


			//===================================================
			// 기본__줌
			$sql_common .= "`pgs_cf_4_n` = '". $basic_zoom ."', ";


			//===================================================
			// 보이는__작은_마커_수
			$sql_common .= "`pgs_cf_6_n` = '". $view_marker_small_t ."', ";


			//===================================================
			// 사용안함
			### FIELD_NULL
			$sql_common .= "`pgs_cf_8_n` = '', ";


			//===================================================
			// 사용안함
			### FIELD_NULL
			$sql_common .= "`pgs_cf_9_n` = '', ";


			//===================================================
			// 마커_출력수__이상_DATA_있으면__보임_방식
			$sql_common .= "`pgs_cf_8_s` = '". $marker_count_many_c ."', ";


			//===================================================
			// InfoWindow_크기__해상도
			$sql_common .= "`pgs_cf_10_n` = '". $infowin_size_w ."', ";
			$sql_common .= "`pgs_cf_11_n` = '". $infowin_size_h ."', ";


			//===================================================
			// 오른쪽_패널_크기__해상도
			$sql_common .= "`pgs_cf_12_n` = '". $panel_size_w ."', ";
			$sql_common .= "`pgs_cf_13_n` = '". $panel_size_h ."', ";


			//===================================================
			// 패널_게시글_목록_이미지__보여주기_여부
			$sql_common .= "`pgs_cf_14_n` = '". $panel_image_view_n ."', ";


			//===================================================
			// 오른쪽_패널_크기__해상도
			$sql_common .= "`pgs_cf_15_n` = '". $panel_image_size_w ."', ";
			$sql_common .= "`pgs_cf_16_n` = '". $panel_image_size_h ."', ";


			//===================================================
			// 패널에_게시글_수
			$sql_common .= "`pgs_cf_17_n` = '". $panel_article_row_n ."', ";


			//===================================================
			// InfoWindow_이미지__보여주기_여부
			$sql_common .= "`pgs_cf_18_n` = '". $infowin_image_view_n ."', ";


			//===================================================
			// InfoWindow_이미지_크기_해상도
			$sql_common .= "`pgs_cf_19_n` = '". $infowin_image_size_w ."', ";
			$sql_common .= "`pgs_cf_20_n` = '". $infowin_image_size_h ."', ";


			//===================================================
			// 지도_로드시_오른쪽_패널__보여주기_여부
			$sql_common .= "`pgs_cf_21_n` = '". $panel_load_view_n ."', ";


			//===================================================
			// 클러스터링_기능__사용_여부
			$sql_common .= "`pgs_cf_22_n` = '". $clustering_use_n ."', ";


			//===================================================
			// 클러스터링_기능_줌
			$sql_common .= "`pgs_cf_23_n` = '". $clustering_zoom ."', ";

			#####################################################
			# 끝 => 항목별__저장하기
			#####################################################



			#####################################################
			# 시작 => 설정__저장하기
			#####################################################

			//===================================================
			// 수정하는__쿼리
			$sql	= "UPDATE `". $piree['program_sam']."` SET ";
			$sql .= $sql_common;
			$sql .= "`pgs_piree_mb_id`	= '". $piree_mb_id ."', ";
			$sql .= "`pgs_modi_time_n`	= '". G5_SERVER_TIME ."' ";
			$sql .= "WHERE `pgs_prog_n` = '". $sub_menu ."'";


			//===================================================
			// 시작 => 쿼리_실행
			IF ( !sql_query ($sql) )
			{

					// 에러_메세지
					$save_err_msg = "\\\"피리 맵 페이지\\\" 설정 정보를 수정하지 못했습니다.";

					// 에러
					alert ($save_err_msg, $go_url_s);
					EXIT;

			}
			// 끝 => 쿼리_실행
			//===================================================

			#####################################################
			# 끝 => 설정__저장하기
			#####################################################

	#########################################################
	# 끝 => 설정__저장하기
	#########################################################



	#########################################################
	# 시작 => 설정_테이블__칼럼_추가__정보_저장하기
	#########################################################

	//=======================================================
	// 사이트_주요_테이블__칼럼_추가__처리하는_파일__첨부
	include_once(G5_ADMIN_PATH.'/_piree/fd_add__piree.inc.php');

	#########################################################
	# 끝 => 설정_테이블__칼럼_추가__정보_저장하기
	#########################################################



	#########################################################
	# 시작 => 마무리__페이지_이동
	#########################################################

	//=======================================================
	// 이동할__페이지
	$go_url_s = "./__config.form.php";


/*


echo "<A HREF=\"".$go_url_s."\">".$go_url_s."</A>";
EXIT;

*/


	//=======================================================
	// 알림창
	alert ('설정 정보를 저장하였습니다.', $go_url_s, 0);
	EXIT;

	#########################################################
	# 끝 => 마무리__페이지_이동
	#########################################################


?>